@model IEnumerable<MyMvcNetCore.ViewModels.Categories.ShowCategory>

@{
    ViewData["Title"] = "Categories";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
}




<h2>Category Management</h2>
<p>
    Manage and organize all your product categories from this page.
    <br>
    View, edit, and create new categories for your system.

</p>
<h3>


    <a asp-action="Add" class="mt-3 btn btn-outline-info"><i class="bi bi-folder-plus"> </i>&nbsp; Add New Category</a>
</h3>
<div class="card shadow-sm mt-4">
    <div class="card-body">
        <h5 class="card-title">Category List</h5>
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>@Html.DisplayNameFor(model => model.Title)</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>

                    @foreach (var item in Model)
                    {
                        <tr>
                            <td class="text-start text-nowrap gap-1 ">
                                @Html.DisplayFor(modelItem => item.Title)
                            </td>
                            <td class="text-end text-nowrap gap-1 ">
                                <a class="btn btn-warning btn-sm" asp-action="Edit" asp-route-id="@item.Id" title="Edit"><i class="bi bi-pencil-square"></i></a>
                                <form asp-action="Delete" asp-route-id="@item.Id" class="d-inline" method="post">
                                    <button title="Delete" class="btn btn-danger btn-sm" @(item.CanRemove ? string.Empty : "disabled")><i class="bi bi-trash"></i></button>
                                </form>
                                <button title="Show Subcategories" class="btn btn-info btn-sm" onclick="showCategoryChildren(@item.Id, '@item.Title')"><i class="bi bi-diagram-3"></i></button>
                            </td>


                        </tr>
                    }
                </tbody>


            </table>
        </div>
    </div>
</div>







<div class="modal fade" tabindex="-1" id="category-children-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Subcategories of <span></span></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="text-center">
                    <img src="/images/application/loading.gif" width="50" alt="Please Wait ..." />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

@section Scripts
{
    <script>
        function showCategoryChildren(mainCatId, mainCatTitle) {
        document.getElementById('category-children-table')?.remove();
        document.querySelector('#category-children-modal .modal-header span').innerHTML = mainCatTitle;
        document.querySelector('#category-children-modal img').classList.remove('d-none');
        const myModal = new bootstrap.Modal(document.getElementById('category-children-modal'));
        myModal.show();
        fetch('/Admin/Category/ShowCategoryChildren?mainCatId=' + mainCatId)
        .then(response => response.text())
        .then(data => {
        document.querySelector('#category-children-modal img').classList.add('d-none');
        document.querySelector('#category-children-modal .modal-body').insertAdjacentHTML('beforeend', data);
        })
        .catch(error => console.error('Error:', error));
        }
    </script>

@* @section Scripts
{
    <script>
        function showCategoryChildren(mainCatId, mainCatTitle) {
            $('#category-children-table').remove();
            $('#category-children-modal .modal-header span').html(mainCatTitle);
            $('#category-children-modal img').removeClass('d-none');
            var myModal = new bootstrap.Modal(document.getElementById('category-children-modal'));
            myModal.show();
            $.ajax({
                url: '/Admin/Category/ShowCategoryChildren',
                data: {mainCatId: mainCatId},
                success: function (data, status) {
                    $('#category-children-modal img').addClass('d-none');
                    $('#category-children-modal .modal-body').append(data);
                },
                dataType: 'HTML'
            });
        }
    </script> *@
}